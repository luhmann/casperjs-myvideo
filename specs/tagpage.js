/**
 * A suite of test methods that are used for testing the tracking-modules
 *
 * @author Jan Florian Dietrich <jfd@daenen4.de>
 */
(function(e,t,n){MV.testing=MV.testing||{},MV.testing.getRandomItem=function(t){var n=e(t),r=MV.utilities.randomInt(0,n.length-1);return n.eq(r)},MV.testing.globalizeLibs=function(){n.$=n.jQuery=MV.jQuery},MV.testing.wait=function(e){jasmine.Clock.useMock(),jasmine.Clock.tick(e)},MV.testing.execute=function(){var e=jasmine.getEnv();e.updateInterval=250,e.addReporter(new jasmine.TapReporter),e.execute()}})(MV.jQuery,MV.logger,window),window._gaq={},window._gaq.push=function(e){MV.utilities.getURLParameter("showTrackingCalls")!==!1&&console.log(e)},MV.ga.followOutboundLink=function(){},MV.trackerTestConfiguration={object:_gaq,module:MV.ga,functions:{event:"push"},trackEvents:MV.ga.trackingEvents,liveMode:MV.utilities.getURLParameter("testTrackingLive")==="true",getTrackerCall:function(e,t,n,r,i){var s=["_trackEvent"];return s.push(e,t,n),s.push(typeof r!="undefined"?r:null),s.push(typeof i!="undefined"&&i===!0),s},getCustomVarCall:function(e,t,n,r){return["_setCustomVar",e,t,n,r]}},function(e,t,n,r){describe("Navigation Tracking",function(){beforeEach(function(){r.liveMode===!1&&(loadFixtures("_navigation.html"),MV.navigation.initTracking()),spyOn(r.object,r.functions.event)});var n=MV.navigation.selectors;it("Navigation Items exist",function(){expect(e(n.level1Link).length).toBeGreaterThan(0)}),it("First Level Click",function(){var i=t.getRandomItem(n.level1Link),s=MV.utilities.isHomePage()?r.trackEvents.navigationHome:r.trackEvents.navigationOther,o=e.trim(i.text()),u=MV.utilities.shortUrl()+"|E1";i.trigger("click"),expect(r.object[r.functions.event]).toHaveBeenCalledWith(r.getTrackerCall(s,o,u)),expect(r.object[r.functions.event]).toHaveBeenCalledWith(["_set","hitCallback",jasmine.any(Function)])}),it("First Level Hover",function(){var i=t.getRandomItem(n.level1Link),s=i.parent().find(n.teaser);if(s.length>0){var o=r.trackEvents.adHover,u=e.trim(i.text()),a=s.attr("title"),f=s.attr("href");i.trigger("mouseenter"),expect(r.object[r.functions.event]).toHaveBeenCalledWith(r.getTrackerCall(o,u+"|Flyout",a+"|"+f))}}),it("Second Level click",function(){var i=t.getRandomItem(n.level2Link),s=e.trim(i.text()),o=e.trim(i.closest(n.level2).parent().find(n.link).first().text()),u=MV.utilities.isHomePage()?r.trackEvents.navigationHome:r.trackEvents.navigationOther;i.trigger("click"),expect(r.object[r.functions.event]).toHaveBeenCalledWith(r.getTrackerCall(u,o+"|"+s,MV.utilities.shortUrl()+"|E2")),expect(r.object[r.functions.event]).toHaveBeenCalledWith(["_set","hitCallback",jasmine.any(Function)])}),it("Third level click",function(){var i=t.getRandomItem(n.level3Link),s=e.trim(i.text()),o=e.trim(i.closest(n.level3).parent().find(n.link).first().text()),u=e.trim(i.closest(n.level2).parent().find(n.link).first().text()),a=MV.utilities.isHomePage()?r.trackEvents.navigationHome:r.trackEvents.navigationOther;i.trigger("click"),expect(r.object[r.functions.event]).toHaveBeenCalledWith(r.getTrackerCall(a,u+"|"+o+"|"+s,MV.utilities.shortUrl()+"|E3")),expect(r.object[r.functions.event]).toHaveBeenCalledWith(["_set","hitCallback",jasmine.any(Function)])}),it("Flyout Click",function(){var i=t.getRandomItem(n.teaser),s=e.trim(i.attr("title")),o=e.trim(i.attr("href")),u=e.trim(i.closest(n.level2).parent().find(n.link).first().text()),a=r.trackEvents.adClick;i.trigger("click"),expect(r.object[r.functions.event]).toHaveBeenCalledWith(r.getTrackerCall(a,u+"|Flyout",MV.utilities.shortUrl()+"|"+s+"|"+o)),expect(r.object[r.functions.event]).toHaveBeenCalledWith(["_set","hitCallback",jasmine.any(Function)])}),it("Upload Button Click",function(){var t=e(n.upload),i=MV.utilities.isHomePage()?r.trackEvents.navigationHome:r.trackEvents.navigationOther,s=t.attr("href");t.trigger("click"),expect(r.object[r.functions.event]).toHaveBeenCalledWith(r.getTrackerCall(i,MV.utilities.shortUrl()+"|Upload",s)),expect(r.object[r.functions.event]).toHaveBeenCalledWith(["_set","hitCallback",jasmine.any(Function)])})})}(MV.jQuery,MV.testing,MV.logger,MV.trackerTestConfiguration),function(e,t,n,r,i,s){describe("Login",function(){beforeEach(function(){s.liveMode===!1&&(loadFixtures("_login.html"),MV.login.initTracking()),spyOn(s.object,s.functions.event)});var t=MV.login.selectors,i=MV.login.events;it("Forgotten Login Credentials-Action",function(){var r=e(t.forgotten),i=s.trackEvents.navigationLogin,o=n.getTrackingString([n.shortUrl(),"Login"]),u=e.trim(r.text());r.click(),expect(s.object[s.functions.event]).toHaveBeenCalledWith(s.getTrackerCall(i,o,u)),expect(s.object[s.functions.event]).toHaveBeenCalledWith(["_set","hitCallback",jasmine.any(Function)])}),it("Register New User-Action",function(){var r=e(t.newUser),i=s.trackEvents.navigationLogin,o=n.getTrackingString([n.shortUrl(),"Login"]),u=e.trim(r.text());r.click(),expect(s.object[s.functions.event]).toHaveBeenCalledWith(s.getTrackerCall(i,o,u)),expect(s.object[s.functions.event]).toHaveBeenCalledWith(["_set","hitCallback",jasmine.any(Function)])}),it("Click on Profile-Button in logged in user-menu",function(){var r=e(t.profile),i=s.trackEvents.navigationLogin,o=n.getTrackingString([n.shortUrl(),"Login"]),u=e.trim(r.text());r.click(),expect(s.object[s.functions.event]).toHaveBeenCalledWith(s.getTrackerCall(i,o,u)),expect(s.object[s.functions.event]).toHaveBeenCalledWith(["_set","hitCallback",jasmine.any(Function)])}),it("Click on My Videos-Button in logged in user-menu",function(){var r=e(t.videos),i=s.trackEvents.navigationLogin,o=n.getTrackingString([n.shortUrl(),"Login"]),u=e.trim(r.text());r.click(),expect(s.object[s.functions.event]).toHaveBeenCalledWith(s.getTrackerCall(i,o,u)),expect(s.object[s.functions.event]).toHaveBeenCalledWith(["_set","hitCallback",jasmine.any(Function)])}),it("Click on Upload-Button in logged in user-menu",function(){var r=e(t.upload),i=s.trackEvents.navigationLogin,o=n.getTrackingString([n.shortUrl(),"Login"]),u=e.trim(r.text());r.click(),expect(s.object[s.functions.event]).toHaveBeenCalledWith(s.getTrackerCall(i,o,u)),expect(s.object[s.functions.event]).toHaveBeenCalledWith(["_set","hitCallback",jasmine.any(Function)])}),it("Click on regular Login-Button",function(){var o=e(t.submit),u=o.attr("data-tracking"),a=s.trackEvents.navigationLogin,f=n.getTrackingString([u,"Login"]),l=n.shortUrl();r.fire(i.pub.buttonClicked,{button:o}),expect(s.object[s.functions.event]).toHaveBeenCalledWith(s.getTrackerCall(a,f,l))}),it("Click on Facebook-Login-Button",function(){e(".login--tab-link").click();var o=e(t.facebookLoginButton).filter(":visible"),u=o.text(),a=o.attr("data-tracking"),f=s.trackEvents.navigationLogin,l=n.getTrackingString([a,u,"Login"]),c=n.shortUrl();r.fire(i.pub.buttonClicked,{button:o}),expect(s.object[s.functions.event]).toHaveBeenCalledWith(s.getTrackerCall(f,l,c))}),it("Click on Google-Login-Button",function(){var o=e(t.googleLoginButton).filter(":visible"),u=o.text(),a=o.attr("data-tracking"),f=s.trackEvents.navigationLogin,l=n.getTrackingString([a,u,"Login"]),c=n.shortUrl();r.fire(i.pub.buttonClicked,{button:o}),expect(s.object[s.functions.event]).toHaveBeenCalledWith(s.getTrackerCall(f,l,c))}),it("Click on Logout-Button",function(){var o=e(t.logoutButton),u=o.attr("data-tracking"),a=s.trackEvents.navigationLogin,f=n.getTrackingString([u,"Logout"]),l=n.shortUrl();r.fire(i.pub.buttonClicked,{button:o}),expect(s.object[s.functions.event]).toHaveBeenCalledWith(s.getTrackerCall(a,f,l))}),it("Login was successful",function(){var e="myvideo";r.fire(i.pub.success,e);var t=s.trackEvents.navigationLogin,o=n.getTrackingString([e,"Login"]),u=n.getTrackingString([n.shortUrl(),"OK"]);expect(s.object[s.functions.event]).toHaveBeenCalledWith(s.getCustomVarCall(5,"Login","yes",2)),expect(s.object[s.functions.event]).toHaveBeenCalledWith(s.getTrackerCall(t,o,u))}),it("Login failed",function(){var e="myvideo";r.fire(i.pub.failed,e);var t=s.trackEvents.navigationLogin,o=n.getTrackingString([e,"Login"]),u=n.getTrackingString([n.shortUrl(),"FAILED"]);expect(s.object[s.functions.event]).toHaveBeenCalledWith(s.getTrackerCall(t,o,u))}),it("Logout was successful",function(){var e="logout";r.fire(i.pub.logout,e);var t=s.trackEvents.navigationLogin,o=n.getTrackingString([e,"Logout"]),u=n.getTrackingString([n.shortUrl(),"LOGOUT"]);expect(s.object[s.functions.event]).toHaveBeenCalledWith(s.getCustomVarCall(5,"Login","no",2)),expect(s.object[s.functions.event]).toHaveBeenCalledWith(s.getTrackerCall(t,o,u))})})}(MV.jQuery,MV.testing,MV.utilities,MV.events,MV.logger,MV.trackerTestConfiguration),function(e,t,n,r,i,s){describe("Search Test",function(){beforeEach(function(){s.liveMode===!1&&(loadFixtures("_search.html"),MV.search.init()),spyOn(s.object,s.functions.event),jasmine.Clock.useMock()});var t=MV.search.selectors,i=MV.search.events;it("Search-Field Exists",function(){expect(e(t.main)).toExist()}),it("Search in Header - no Autocomplete",function(){var n="Madonna Foo Bar",i=e(t.main),o=e(t.searchField);i.submit(function(e){e.preventDefault()}),o.val(n);var u=s.trackEvents.search,a=r.getTrackingString(["Search",r.shortUrl()]),f=e.trim(o.val()).toLowerCase();i.submit(),expect(s.object[s.functions.event]).toHaveBeenCalledWith(s.getTrackerCall(u,a,f))}),it("Setting of Search-Cookie",function(){var e="nextLevelSearch",t=s.trackEvents.serpOther,r="Cookie Set",o=e,u=!0;n.fire(i.pub.cookieSet,{type:e}),expect(s.object[s.functions.event]).toHaveBeenCalledWith(s.getCustomVarCall(1,"searchType",e,1)),expect(s.object[s.functions.event]).toHaveBeenCalledWith(s.getTrackerCall(t,r,o,null,u))})})}(MV.jQuery,MV.testing,MV.events,MV.utilities,MV.logger,MV.trackerTestConfiguration),function(e,t,n,r,i){describe("Welcome Screen Tracking",function(){beforeEach(function(){i.liveMode===!1&&loadFixtures("_welcomeScreen.html"),spyOn(i.object,i.functions.event)});var t=MV.welcomeScreen.selectors;it("Click on welcome screen",function(){var r=e(t.main),s=r.attr("href"),o=i.trackEvents.adClick,u="WelcomeScreen",a=n.getTrackingString([n.shortUrl(),s]);r.trigger("click"),expect(i.object[i.functions.event]).toHaveBeenCalledWith(i.getTrackerCall(o,u,a)),expect(i.object[i.functions.event]).toHaveBeenCalledWith(["_set","hitCallback",jasmine.any(Function)]),expect(i.object[i.functions.event].callCount).toBe(2)}),it("Closing welcome screen",function(){var r=e(t.closeButton),s=r.closest(t.main).attr("href"),o=i.trackEvents.adClick,u="WelcomeScreenClose",a=n.getTrackingString([n.shortUrl(),s]);r.click(),expect(i.object[i.functions.event]).toHaveBeenCalledWith(i.getTrackerCall(o,u,a)),expect(i.object[i.functions.event]).toHaveBeenCalledWith(["_set","hitCallback",jasmine.any(Function)]),expect(i.object[i.functions.event].callCount).toBe(2)})})}(MV.jQuery,MV.testing,MV.utilities,MV.logger,MV.trackerTestConfiguration),function(e,t,n,r,i){describe("Thumbnail/Image Tracking",function(){beforeEach(function(){spyOn(i.object,i.functions.event)}),afterEach(function(){});var r=MV.thumbnail.selectors;it("Click on Premium-Thumbnail (right now Maxdome)",function(){i.liveMode===!1&&loadFixtures("_videolist.html");var s=t.getRandomItem(r.premium),o=s.attr("href"),u=e.trim(s.find(r.mainTitle).text()),a=i.trackEvents.premiumTeaser,f=n.shortUrl(),l=n.getTrackingString([u,o]);s.click(),expect(i.object[i.functions.event]).toHaveBeenCalledWith(i.getTrackerCall(a,f,l))}),it("Click on an item within a videolist",function(){i.liveMode===!1&&loadFixtures("_videolist.html");var e=t.getRandomItem(r.videolistItem),s=e.closest(r.videolist).data("listName"),o=s==="sidebar_player"?"Sidebar":s,u=e.find(r.thumbnail).attr("href"),a=i.trackEvents.videoListTeaser,f=n.getTrackingString([o,n.shortUrl()]),l=u;e.click(),expect(i.object[i.functions.event]).toHaveBeenCalledWith(i.getTrackerCall(a,f,l))}),it("Click on an Image that is not a thumbnail and not an ad",function(){i.liveMode===!1&&loadFixtures("_thumbnail.html");var e=t.getRandomItem(r.image+":not(.is-ad)"),s=e.attr("href"),o=e.attr("title"),u=i.trackEvents.teaserOther,a=n.shortUrl(),f=n.getTrackingString([s,o]);e.click(),expect(i.object[i.functions.event]).toHaveBeenCalledWith(i.getTrackerCall(u,a,f)),expect(i.object[i.functions.event]).toHaveBeenCalledWith(["_set","hitCallback",jasmine.any(Function)])}),it("Click on an Image that is not a thumbnail but an ad",function(){i.liveMode===!1&&loadFixtures("_thumbnail.html");var e=t.getRandomItem(r.imageAd),s=e.attr("href"),o=e.attr("title"),u=i.trackEvents.adClick,a=n.shortUrl(),f=n.getTrackingString([s,o]);e.click(),expect(i.object[i.functions.event]).toHaveBeenCalledWith(i.getTrackerCall(u,a,f)),expect(i.object[i.functions.event]).toHaveBeenCalledWith(["_set","hitCallback",jasmine.any(Function)])})})}(MV.jQuery,MV.testing,MV.utilities,MV.logger,MV.trackerTestConfiguration);